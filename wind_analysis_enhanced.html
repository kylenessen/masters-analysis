<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kyle Nessen">
<meta name="dcterms.date" content="2025-08-12">

<title>Enhanced Wind Analysis: Full Dataset with Changepoint Detection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="wind_analysis_enhanced_files/libs/clipboard/clipboard.min.js"></script>
<script src="wind_analysis_enhanced_files/libs/quarto-html/quarto.js"></script>
<script src="wind_analysis_enhanced_files/libs/quarto-html/popper.min.js"></script>
<script src="wind_analysis_enhanced_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="wind_analysis_enhanced_files/libs/quarto-html/anchor.min.js"></script>
<link href="wind_analysis_enhanced_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="wind_analysis_enhanced_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="wind_analysis_enhanced_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="wind_analysis_enhanced_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="wind_analysis_enhanced_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#enhanced-analysis-goals" id="toc-enhanced-analysis-goals" class="nav-link active" data-scroll-target="#enhanced-analysis-goals">Enhanced Analysis Goals</a></li>
  <li><a href="#data-loading-and-full-dataset-preparation" id="toc-data-loading-and-full-dataset-preparation" class="nav-link" data-scroll-target="#data-loading-and-full-dataset-preparation">Data Loading and Full Dataset Preparation</a></li>
  <li><a href="#changepoint-detection-for-data-driven-thresholds" id="toc-changepoint-detection-for-data-driven-thresholds" class="nav-link" data-scroll-target="#changepoint-detection-for-data-driven-thresholds">Changepoint Detection for Data-Driven Thresholds</a></li>
  <li><a href="#enhanced-gam-models-with-full-dataset" id="toc-enhanced-gam-models-with-full-dataset" class="nav-link" data-scroll-target="#enhanced-gam-models-with-full-dataset">Enhanced GAM Models with Full Dataset</a></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics">Model Diagnostics</a>
  <ul class="collapse">
  <li><a href="#diagnostics-for-gam_enhanced_full" id="toc-diagnostics-for-gam_enhanced_full" class="nav-link" data-scroll-target="#diagnostics-for-gam_enhanced_full">Diagnostics for <code>gam_enhanced_full</code></a></li>
  <li><a href="#diagnostics-for-gam_three_way" id="toc-diagnostics-for-gam_three_way" class="nav-link" data-scroll-target="#diagnostics-for-gam_three_way">Diagnostics for <code>gam_three_way</code></a></li>
  <li><a href="#concurvity-check" id="toc-concurvity-check" class="nav-link" data-scroll-target="#concurvity-check">Concurvity Check</a></li>
  </ul></li>
  <li><a href="#temperature-stratified-models" id="toc-temperature-stratified-models" class="nav-link" data-scroll-target="#temperature-stratified-models">Temperature-Stratified Models</a>
  <ul class="collapse">
  <li><a href="#diagnostics-for-stratified-models" id="toc-diagnostics-for-stratified-models" class="nav-link" data-scroll-target="#diagnostics-for-stratified-models">Diagnostics for Stratified Models</a></li>
  </ul></li>
  <li><a href="#site-specific-analysis-for-consistency" id="toc-site-specific-analysis-for-consistency" class="nav-link" data-scroll-target="#site-specific-analysis-for-consistency">Site-Specific Analysis for Consistency</a></li>
  <li><a href="#data-driven-threshold-testing" id="toc-data-driven-threshold-testing" class="nav-link" data-scroll-target="#data-driven-threshold-testing">Data-Driven Threshold Testing</a></li>
  <li><a href="#biological-relevance-assessment" id="toc-biological-relevance-assessment" class="nav-link" data-scroll-target="#biological-relevance-assessment">Biological Relevance Assessment</a></li>
  <li><a href="#publication-ready-summary" id="toc-publication-ready-summary" class="nav-link" data-scroll-target="#publication-ready-summary">Publication-Ready Summary</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Enhanced Wind Analysis: Full Dataset with Changepoint Detection</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kyle Nessen </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 12, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="enhanced-analysis-goals" class="level1">
<h1>Enhanced Analysis Goals</h1>
<p>Building on the initial defensible analysis, this enhanced version:</p>
<ol type="1">
<li><strong>Uses full dataset</strong> (no sampling) for maximum statistical power</li>
<li><strong>Implements changepoint detection</strong> to find data-driven thresholds</li>
<li><strong>Tests stratified models</strong> by temperature ranges</li>
<li><strong>Examines site-specific effects</strong> for consistency</li>
<li><strong>Assesses biological relevance</strong> of effect sizes</li>
</ol>
</section>
<section id="data-loading-and-full-dataset-preparation" class="level1">
<h1>Data Loading and Full Dataset Preparation</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load core datasets</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>butterfly_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/butterfly_abundance_index.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>wind_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/wind_all.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>temperature_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/temperature_data_2023.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>deployments <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/deployments.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to complete deployments</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>complete_deployments <span class="ot">&lt;-</span> deployments <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(monarchs_present <span class="sc">==</span> <span class="cn">TRUE</span>, label_status <span class="sc">==</span> <span class="st">"Complete"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(deployment_id, view_id, wind_meter_name)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Complete deployments:"</span>, <span class="fu">nrow</span>(complete_deployments)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Complete deployments: 12"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process butterfly data - FULL DATASET</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>butterfly_clean <span class="ot">&lt;-</span> butterfly_data <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">timestamp_str =</span> <span class="fu">str_extract</span>(image_filename, <span class="st">"</span><span class="sc">\\</span><span class="st">d{14}"</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">ymd_hms</span>(timestamp_str, <span class="at">truncated =</span> <span class="dv">3</span>),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as_date</span>(datetime),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour =</span> <span class="fu">hour</span>(datetime)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(complete_deployments, <span class="at">by =</span> <span class="st">"deployment_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hour <span class="sc">&gt;=</span> <span class="dv">6</span>, hour <span class="sc">&lt;=</span> <span class="dv">18</span>) <span class="sc">%&gt;%</span>  <span class="co"># Daylight only</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(deployment_id, datetime)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Full butterfly dataset (daylight):"</span>, <span class="fu">nrow</span>(butterfly_clean)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Full butterfly dataset (daylight): 6434"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process wind data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>wind_clean <span class="ot">&lt;-</span> wind_data <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">datetime =</span> <span class="fu">ymd_hms</span>(time)) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(wind_meter_name <span class="sc">%in%</span> complete_deployments<span class="sc">$</span>wind_meter_name,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         datetime <span class="sc">&gt;=</span> <span class="fu">min</span>(butterfly_clean<span class="sc">$</span>datetime) <span class="sc">-</span> <span class="fu">hours</span>(<span class="dv">24</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>         datetime <span class="sc">&lt;=</span> <span class="fu">max</span>(butterfly_clean<span class="sc">$</span>datetime) <span class="sc">+</span> <span class="fu">hours</span>(<span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(wind_meter_name, datetime, speed, gust) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(wind_meter_name, datetime)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Process temperature data  </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>temp_clean <span class="ot">&lt;-</span> temperature_data <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">datetime =</span> <span class="fu">ymd_hms</span>(timestamp)) <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(deployment_id, datetime, temperature)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Wind observations:"</span>, <span class="fu">nrow</span>(wind_clean)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Wind observations: 372674"</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhanced wind metrics function with additional metrics</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>get_enhanced_wind_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(wind_meter, target_time, wind_df, <span class="at">window_minutes =</span> <span class="dv">30</span>) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  start_time <span class="ot">&lt;-</span> target_time <span class="sc">-</span> <span class="fu">minutes</span>(window_minutes)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  wind_subset <span class="ot">&lt;-</span> wind_df <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(wind_meter_name <span class="sc">==</span> wind_meter,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>           datetime <span class="sc">&gt;=</span> start_time,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>           datetime <span class="sc">&lt;=</span> target_time) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(datetime)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(wind_subset) <span class="sc">&lt;</span> <span class="dv">3</span>) {</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_wind =</span> <span class="cn">NA</span>, <span class="at">max_wind =</span> <span class="cn">NA</span>, <span class="at">wind_sd =</span> <span class="cn">NA</span>, <span class="at">gust_factor =</span> <span class="cn">NA</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">minutes_above_2ms =</span> <span class="cn">NA</span>, <span class="at">minutes_above_3ms =</span> <span class="cn">NA</span>, <span class="at">sustained_above_2ms =</span> <span class="cn">NA</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_sustained_wind =</span> <span class="cn">NA</span>, <span class="at">wind_ramp_rate =</span> <span class="cn">NA</span>, <span class="at">cumulative_wind =</span> <span class="cn">NA</span>, </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_wind_obs =</span> <span class="dv">0</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  speeds <span class="ot">&lt;-</span> wind_subset<span class="sc">$</span>speed</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  mean_wind <span class="ot">&lt;-</span> <span class="fu">mean</span>(speeds, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  max_wind <span class="ot">&lt;-</span> <span class="fu">max</span>(speeds, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate sustained periods above thresholds</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  above_2ms <span class="ot">&lt;-</span> speeds <span class="sc">&gt;</span> <span class="dv">2</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  above_3ms <span class="ot">&lt;-</span> speeds <span class="sc">&gt;</span> <span class="dv">3</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find longest consecutive period above 2 m/s</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(above_2ms)) {</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    rle_2ms <span class="ot">&lt;-</span> <span class="fu">rle</span>(above_2ms)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    sustained_above_2ms <span class="ot">&lt;-</span> <span class="fu">max</span>(rle_2ms<span class="sc">$</span>lengths[rle_2ms<span class="sc">$</span>values], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    sustained_above_2ms <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Maximum sustained wind over 5+ minute periods</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(speeds) <span class="sc">&gt;=</span> <span class="dv">5</span>) {</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    rolling_5min <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">5</span><span class="sc">:</span><span class="fu">length</span>(speeds), <span class="cf">function</span>(i) {</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(speeds[(i<span class="dv">-4</span>)<span class="sc">:</span>i], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    max_sustained_wind <span class="ot">&lt;-</span> <span class="fu">max</span>(rolling_5min, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    max_sustained_wind <span class="ot">&lt;-</span> mean_wind</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Wind ramp rate (change per minute)</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(speeds) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    wind_diffs <span class="ot">&lt;-</span> <span class="fu">diff</span>(speeds)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    wind_ramp_rate <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(wind_diffs), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    wind_ramp_rate <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_wind =</span> mean_wind,</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_wind =</span> max_wind,</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">wind_sd =</span> <span class="fu">sd</span>(speeds, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">gust_factor =</span> <span class="fu">ifelse</span>(mean_wind <span class="sc">&gt;</span> <span class="dv">0</span>, max_wind <span class="sc">/</span> mean_wind, <span class="cn">NA</span>),</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">minutes_above_2ms =</span> <span class="fu">sum</span>(above_2ms, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">minutes_above_3ms =</span> <span class="fu">sum</span>(above_3ms, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">sustained_above_2ms =</span> sustained_above_2ms,</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_sustained_wind =</span> max_sustained_wind,</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">wind_ramp_rate =</span> wind_ramp_rate,</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumulative_wind =</span> <span class="fu">sum</span>(speeds, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_wind_obs =</span> <span class="fu">nrow</span>(wind_subset)</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for longer-term wind exposure</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>get_wind_exposure <span class="ot">&lt;-</span> <span class="cf">function</span>(wind_meter, target_time, wind_df, <span class="at">hours_back =</span> <span class="dv">2</span>) {</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>  start_time <span class="ot">&lt;-</span> target_time <span class="sc">-</span> <span class="fu">hours</span>(hours_back)</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>  wind_subset <span class="ot">&lt;-</span> wind_df <span class="sc">%&gt;%</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(wind_meter_name <span class="sc">==</span> wind_meter,</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>           datetime <span class="sc">&gt;=</span> start_time,</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>           datetime <span class="sc">&lt;=</span> target_time)</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(wind_subset) <span class="sc">&lt;</span> <span class="dv">3</span>) {</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">cumulative_wind_exposure =</span> <span class="cn">NA</span>,</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_wind_exposure =</span> <span class="cn">NA</span>,</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_wind_exposure =</span> <span class="cn">NA</span>,</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_minutes_above_2ms =</span> <span class="cn">NA</span>,</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_obs =</span> <span class="dv">0</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumulative_wind_exposure =</span> <span class="fu">sum</span>(wind_subset<span class="sc">$</span>speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_wind_exposure =</span> <span class="fu">max</span>(wind_subset<span class="sc">$</span>speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_wind_exposure =</span> <span class="fu">mean</span>(wind_subset<span class="sc">$</span>speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_minutes_above_2ms =</span> <span class="fu">sum</span>(wind_subset<span class="sc">$</span>speed <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_obs =</span> <span class="fu">nrow</span>(wind_subset)</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create full analysis dataset - this may take several minutes</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Creating full analysis dataset... this may take several minutes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Creating full analysis dataset... this may take several minutes"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process in chunks to manage memory</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>chunk_size <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>n_chunks <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">nrow</span>(butterfly_clean) <span class="sc">/</span> chunk_size)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>analysis_data_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_chunks) {</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  start_idx <span class="ot">&lt;-</span> (i<span class="dv">-1</span>) <span class="sc">*</span> chunk_size <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  end_idx <span class="ot">&lt;-</span> <span class="fu">min</span>(i <span class="sc">*</span> chunk_size, <span class="fu">nrow</span>(butterfly_clean))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Processing chunk"</span>, i, <span class="st">"of"</span>, n_chunks, <span class="st">"...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  chunk_data <span class="ot">&lt;-</span> butterfly_clean[start_idx<span class="sc">:</span>end_idx, ] <span class="sc">%&gt;%</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add wind statistics</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Primary wind metrics (30-min window)</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">wind_stats =</span> <span class="fu">list</span>(<span class="fu">get_enhanced_wind_stats</span>(wind_meter_name, datetime, wind_clean, <span class="dv">30</span>)),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 2-hour cumulative exposure</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">wind_exposure =</span> <span class="fu">list</span>(<span class="fu">get_wind_exposure</span>(wind_meter_name, datetime, wind_clean, <span class="dv">2</span>))</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_wider</span>(wind_stats) <span class="sc">%&gt;%</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_wider</span>(wind_exposure, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  analysis_data_list[[i]] <span class="ot">&lt;-</span> chunk_data</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Processing chunk 1 of 2 ...
Processing chunk 2 of 2 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all chunks</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>analysis_data_raw <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(analysis_data_list)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(analysis_data_list)  <span class="co"># Free memory</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Raw analysis data created:"</span>, <span class="fu">nrow</span>(analysis_data_raw), <span class="st">"observations"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Raw analysis data created: 6434 observations"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add temperature and create temporal lags</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>analysis_data_full <span class="ot">&lt;-</span> analysis_data_raw <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add temperature</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(temp_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"deployment_id"</span>, <span class="st">"datetime"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate temporal lags</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(deployment_id, datetime) <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(deployment_id) <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Multiple abundance lags</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">abundance_lag_30min =</span> <span class="fu">lag</span>(total_butterflies, <span class="dv">1</span>),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">abundance_lag_1hr =</span> <span class="fu">lag</span>(total_butterflies, <span class="dv">2</span>),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">abundance_lag_2hr =</span> <span class="fu">lag</span>(total_butterflies, <span class="dv">4</span>),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">abundance_lag_4hr =</span> <span class="fu">lag</span>(total_butterflies, <span class="dv">8</span>),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">abundance_lag_24hr =</span> <span class="fu">lag</span>(total_butterflies, <span class="dv">48</span>),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time since first observation</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">minutes_since_first =</span> <span class="fu">as.numeric</span>(datetime <span class="sc">-</span> <span class="fu">first</span>(datetime), <span class="at">units =</span> <span class="st">"mins"</span>),</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time differences for validation</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_diff_30min =</span> <span class="fu">as.numeric</span>(datetime <span class="sc">-</span> <span class="fu">lag</span>(datetime, <span class="dv">1</span>), <span class="at">units =</span> <span class="st">"mins"</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply defensible filtering</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(mean_wind),</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(temperature),</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    n_wind_obs <span class="sc">&gt;=</span> <span class="dv">3</span>,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove consecutive zeros</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>(total_butterflies <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> abundance_lag_30min <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reasonable time gaps</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    time_diff_30min <span class="sc">&lt;=</span> <span class="dv">60</span> <span class="sc">|</span> <span class="fu">is.na</span>(time_diff_30min)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create derived variables</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_abundance =</span> <span class="fu">log</span>(total_butterflies <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_abundance_lag_30min =</span> <span class="fu">log</span>(abundance_lag_30min <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_abundance_lag_24hr =</span> <span class="fu">log</span>(abundance_lag_24hr <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour_of_day =</span> <span class="fu">hour</span>(datetime),</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">sunlight_prop =</span> <span class="fu">ifelse</span>(total_butterflies <span class="sc">&gt;</span> <span class="dv">0</span>, </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>                          butterflies_direct_sun <span class="sc">/</span> total_butterflies, <span class="dv">0</span>),</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Temperature categories for stratified analysis</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>      temperature <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">~</span> <span class="st">"Cold"</span>,</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>      temperature <span class="sc">&gt;=</span> <span class="dv">15</span> <span class="sc">&amp;</span> temperature <span class="sc">&lt;</span> <span class="dv">25</span> <span class="sc">~</span> <span class="st">"Moderate"</span>, </span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>      temperature <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">~</span> <span class="st">"Warm"</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">view_id =</span> <span class="fu">factor</span>(view_id),</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">deployment_id =</span> <span class="fu">factor</span>(deployment_id),</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Binary indicators</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">wind_above_2ms =</span> <span class="fu">as.numeric</span>(mean_wind <span class="sc">&gt;</span> <span class="dv">2</span>),</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">wind_above_3ms =</span> <span class="fu">as.numeric</span>(mean_wind <span class="sc">&gt;</span> <span class="dv">3</span>)</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Final full analysis dataset:"</span>, <span class="fu">nrow</span>(analysis_data_full), <span class="st">"observations"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Final full analysis dataset: 2993 observations"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Deployments:"</span>, <span class="fu">n_distinct</span>(analysis_data_full<span class="sc">$</span>deployment_id)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Deployments: 10"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Views:"</span>, <span class="fu">n_distinct</span>(analysis_data_full<span class="sc">$</span>view_id)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Views: 8"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Date range:"</span>, <span class="fu">min</span>(analysis_data_full<span class="sc">$</span>datetime), <span class="st">"to"</span>, <span class="fu">max</span>(analysis_data_full<span class="sc">$</span>datetime)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Date range: 2023-11-17 18:45:01 to 2024-02-04 10:10:01"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save intermediate dataset for future use</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(analysis_data_full, <span class="st">"full_wind_analysis_dataset.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="changepoint-detection-for-data-driven-thresholds" class="level1">
<h1>Changepoint Detection for Data-Driven Thresholds</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for changepoint analysis</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>cp_data <span class="ot">&lt;-</span> analysis_data_full <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mean_wind), <span class="sc">!</span><span class="fu">is.na</span>(total_butterflies)) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean_wind) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use log abundance for analysis</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_abundance =</span> <span class="fu">log</span>(total_butterflies <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 1: Simple changepoint detection on wind-abundance relationship</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create binned data for changepoint analysis</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>wind_bins <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">ceiling</span>(<span class="fu">max</span>(cp_data<span class="sc">$</span>mean_wind)), <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>binned_data <span class="ot">&lt;-</span> cp_data <span class="sc">%&gt;%</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wind_bin =</span> <span class="fu">cut</span>(mean_wind, <span class="at">breaks =</span> wind_bins, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(wind_bin) <span class="sc">%&gt;%</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">wind_midpoint =</span> <span class="fu">mean</span>(mean_wind, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_log_abundance =</span> <span class="fu">mean</span>(log_abundance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_obs =</span> <span class="fu">n</span>(),</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_obs <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span>  <span class="co"># Only use bins with sufficient data</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(wind_midpoint)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Number of wind bins for changepoint analysis:"</span>, <span class="fu">nrow</span>(binned_data)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of wind bins for changepoint analysis: 27"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PELT (Pruned Exact Linear Time) changepoint detection</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(binned_data) <span class="sc">&gt;=</span> <span class="dv">10</span>) {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  cp_pelt <span class="ot">&lt;-</span> <span class="fu">cpt.mean</span>(binned_data<span class="sc">$</span>mean_log_abundance, <span class="at">method =</span> <span class="st">"PELT"</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  cp_points_pelt <span class="ot">&lt;-</span> <span class="fu">cpts</span>(cp_pelt)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(cp_points_pelt) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    cp_wind_values_pelt <span class="ot">&lt;-</span> binned_data<span class="sc">$</span>wind_midpoint[cp_points_pelt]</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"PELT Changepoints at wind speeds:"</span>, <span class="fu">paste</span>(<span class="fu">round</span>(cp_wind_values_pelt, <span class="dv">2</span>), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"m/s</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"No changepoints detected with PELT</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    cp_wind_values_pelt <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Insufficient data for PELT changepoint detection</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  cp_wind_values_pelt <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>No changepoints detected with PELT</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 2: Alternative changepoint detection using variance</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(binned_data) <span class="sc">&gt;=</span> <span class="dv">10</span>) {</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use variance-based changepoint detection</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  cp_var <span class="ot">&lt;-</span> <span class="fu">cpt.var</span>(binned_data<span class="sc">$</span>mean_log_abundance, <span class="at">method =</span> <span class="st">"PELT"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  cp_points_var <span class="ot">&lt;-</span> <span class="fu">cpts</span>(cp_var)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(cp_points_var) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    cp_wind_values_var <span class="ot">&lt;-</span> binned_data<span class="sc">$</span>wind_midpoint[cp_points_var]</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Variance Changepoints at wind speeds:"</span>, </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="fu">round</span>(cp_wind_values_var, <span class="dv">2</span>), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"m/s</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"No variance changepoints detected</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    cp_wind_values_var <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  cp_wind_values_var <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>No variance changepoints detected</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot changepoint results</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>p_cp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(binned_data, <span class="fu">aes</span>(<span class="at">x =</span> wind_midpoint, <span class="at">y =</span> mean_log_abundance)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n_obs), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"N obs"</span>) <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Changepoint Detection: Wind Speed vs Log Abundance"</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Red line: Leong's 2 m/s threshold"</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Mean Wind Speed (m/s)"</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mean Log Abundance"</span>) <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add detected changepoints</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(cp_wind_values_pelt)) {</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  p_cp <span class="ot">&lt;-</span> p_cp <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> cp_wind_values_pelt, </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(cp_wind_values_var)) {</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  p_cp <span class="ot">&lt;-</span> p_cp <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> cp_wind_values_var, </span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_cp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="wind_analysis_enhanced_files/figure-html/changepoint-analysis-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store detected thresholds for later use</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>detected_thresholds <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(cp_wind_values_pelt, cp_wind_values_var))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(detected_thresholds) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  detected_thresholds <span class="ot">&lt;-</span> detected_thresholds[detected_thresholds <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> detected_thresholds <span class="sc">&lt;</span> <span class="dv">5</span>]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Data-driven thresholds to test:"</span>, <span class="fu">paste</span>(<span class="fu">round</span>(detected_thresholds, <span class="dv">2</span>), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"m/s</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  detected_thresholds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.5</span>)  <span class="co"># Fallback thresholds</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Using fallback thresholds: 1.5, 2.5 m/s</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Using fallback thresholds: 1.5, 2.5 m/s</code></pre>
</div>
</div>
</section>
<section id="enhanced-gam-models-with-full-dataset" class="level1">
<h1>Enhanced GAM Models with Full Dataset</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Primary enhanced model with full dataset</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>gam_enhanced_full <span class="ot">&lt;-</span> <span class="fu">gam</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  total_butterflies <span class="sc">~</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Temporal autocorrelation controls</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(log_abundance_lag_30min, <span class="at">k =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(log_abundance_lag_24hr, <span class="at">k =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enhanced wind predictors</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(mean_wind, <span class="at">k =</span> <span class="dv">10</span>) <span class="sc">+</span>  <span class="co"># Increased complexity</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(wind_sd, <span class="at">k =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(max_sustained_wind, <span class="at">k =</span> <span class="dv">8</span>) <span class="sc">+</span>  <span class="co"># New metric</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(wind_ramp_rate, <span class="at">k =</span> <span class="dv">6</span>) <span class="sc">+</span>      <span class="co"># New metric</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Environmental controls</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(temperature, <span class="at">k =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(sunlight_prop, <span class="at">k =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(minutes_since_first, <span class="at">k =</span> <span class="dv">10</span>, <span class="at">bs =</span> <span class="st">"cc"</span>) <span class="sc">+</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Interactions</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ti</span>(mean_wind, temperature, <span class="at">k =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Site effects</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(view_id, <span class="at">bs =</span> <span class="st">"re"</span>),</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">nb</span>(),</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_data_full,</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"REML"</span>,</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">select =</span> <span class="cn">TRUE</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Enhanced GAM Model Summary:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Enhanced GAM Model Summary:"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gam_enhanced_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Family: Negative Binomial(13.604) 
Link function: log 

Formula:
total_butterflies ~ s(log_abundance_lag_30min, k = 10) + s(log_abundance_lag_24hr, 
    k = 8) + s(mean_wind, k = 10) + s(wind_sd, k = 6) + s(max_sustained_wind, 
    k = 8) + s(wind_ramp_rate, k = 6) + s(temperature, k = 10) + 
    s(sunlight_prop, k = 6) + s(minutes_since_first, k = 10, 
    bs = "cc") + ti(mean_wind, temperature, k = c(6, 6)) + s(view_id, 
    bs = "re")

Parametric coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  3.24972    0.02909   111.7   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
                                 edf Ref.df    Chi.sq  p-value    
s(log_abundance_lag_30min) 7.6655726      9 29733.194  &lt; 2e-16 ***
s(log_abundance_lag_24hr)  0.0012473      7     0.000 0.731990    
s(mean_wind)               2.0546249      9    11.170 0.008942 ** 
s(wind_sd)                 0.3420302      5     0.477 0.224366    
s(max_sustained_wind)      0.0004156      7     0.000 0.591241    
s(wind_ramp_rate)          0.0010446      5     0.001 0.412248    
s(temperature)             4.2322140      9    24.607 0.000281 ***
s(sunlight_prop)           3.3859135      5    27.035 1.35e-05 ***
s(minutes_since_first)     0.0028095      8     0.002 0.548846    
ti(mean_wind,temperature)  0.0030539     25     0.002 0.472334    
s(view_id)                 4.0334904      5    34.429  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.942   Deviance explained = 92.6%
-REML = 9989.9  Scale est. = 1         n = 2714</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model with three-way interaction</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>gam_three_way <span class="ot">&lt;-</span> <span class="fu">gam</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  total_butterflies <span class="sc">~</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(log_abundance_lag_30min, <span class="at">k =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(log_abundance_lag_24hr, <span class="at">k =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(mean_wind, <span class="at">k =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(temperature, <span class="at">k =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(sunlight_prop, <span class="at">k =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(minutes_since_first, <span class="at">k =</span> <span class="dv">10</span>, <span class="at">bs =</span> <span class="st">"cc"</span>) <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Three-way interaction</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ti</span>(mean_wind, temperature, sunlight_prop, <span class="at">k =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">s</span>(view_id, <span class="at">bs =</span> <span class="st">"re"</span>),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">nb</span>(),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> analysis_data_full,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"REML"</span>,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">select =</span> <span class="cn">TRUE</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Three-way Interaction Model Summary:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Three-way Interaction Model Summary:"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gam_three_way)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Family: Negative Binomial(13.612) 
Link function: log 

Formula:
total_butterflies ~ s(log_abundance_lag_30min, k = 10) + s(log_abundance_lag_24hr, 
    k = 8) + s(mean_wind, k = 10) + s(temperature, k = 10) + 
    s(sunlight_prop, k = 6) + s(minutes_since_first, k = 10, 
    bs = "cc") + ti(mean_wind, temperature, sunlight_prop, k = c(4, 
    4, 4)) + s(view_id, bs = "re")

Parametric coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  3.24916    0.02951   110.1   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
                                             edf Ref.df    Chi.sq  p-value    
s(log_abundance_lag_30min)              7.669691      9 30368.886  &lt; 2e-16 ***
s(log_abundance_lag_24hr)               0.002668      7     0.001 0.728234    
s(mean_wind)                            2.150283      9    12.886 0.010152 *  
s(temperature)                          4.195160      9    23.576 0.000332 ***
s(sunlight_prop)                        3.356340      5    26.982  1.4e-05 ***
s(minutes_since_first)                  0.005464      8     0.003 0.543613    
ti(mean_wind,temperature,sunlight_prop) 2.606807     27     5.149 0.082142 .  
s(view_id)                              4.046047      5    35.340  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.942   Deviance explained = 92.6%
-REML = 9989.6  Scale est. = 1         n = 2714</code></pre>
</div>
</div>
</section>
<section id="model-diagnostics" class="level1">
<h1>Model Diagnostics</h1>
<p>Here we will check the primary models for any issues to ensure their validity.</p>
<section id="diagnostics-for-gam_enhanced_full" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics-for-gam_enhanced_full">Diagnostics for <code>gam_enhanced_full</code></h2>
<p>The <code>appraise()</code> function from the <code>gratia</code> package provides a set of standard diagnostic plots to check the model assumptions. We are looking for: 1. <strong>Residuals vs.&nbsp;Fitted</strong>: No obvious patterns, points should be randomly scattered. 2. <strong>Q-Q Plot</strong>: Points should fall along the diagonal line, indicating normally distributed residuals. 3. <strong>Histogram of Residuals</strong>: Should resemble a normal distribution. 4. <strong>Response vs.&nbsp;Fitted</strong>: Points should cluster around the y=x line.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Appraise the model to check assumptions</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">"gam_enhanced_full"</span>)) {</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">appraise</span>(gam_enhanced_full))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Model 'gam_enhanced_full' not found."</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wind_analysis_enhanced_files/figure-html/diagnostics-enhanced-full-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Diagnostic plots for the full enhanced GAM model.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="diagnostics-for-gam_three_way" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics-for-gam_three_way">Diagnostics for <code>gam_three_way</code></h2>
<p>We perform the same checks on the model that includes a three-way interaction term.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Appraise the three-way interaction model</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">"gam_three_way"</span>)) {</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">appraise</span>(gam_three_way))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Model 'gam_three_way' not found."</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wind_analysis_enhanced_files/figure-html/diagnostics-three-way-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Diagnostic plots for the three-way interaction model.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="concurvity-check" class="level2">
<h2 class="anchored" data-anchor-id="concurvity-check">Concurvity Check</h2>
<p>Concurvity is the GAM equivalent of multicollinearity. It occurs when some smooth terms in the model could be approximated by one or more other smooth terms. We check for it to ensure that model terms are not confounded. A value close to 1 indicates high concurvity. The overall measure indicates the worst-case concurvity for each term.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for concurvity</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">"gam_enhanced_full"</span>)) {</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">concurvity</span>(gam_enhanced_full)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         para s(log_abundance_lag_30min) s(log_abundance_lag_24hr) s(mean_wind)
worst       1                  0.6693615                 0.6443702    0.9999889
observed    1                  0.5263181                 0.5146039    0.9853320
estimate    1                  0.4759121                 0.4481147    0.9791530
         s(wind_sd) s(max_sustained_wind) s(wind_ramp_rate) s(temperature)
worst     0.9652787             0.9953221         0.9142839      0.9999980
observed  0.9469965             0.9928248         0.8696933      0.8759415
estimate  0.8084792             0.9818353         0.8089704      0.6638013
         s(sunlight_prop) s(minutes_since_first) ti(mean_wind,temperature)
worst           0.3244038              0.8225002                 0.9999983
observed        0.2612206              0.3147627                 0.2547175
estimate        0.2804819              0.4139227                 0.2748114
         s(view_id)
worst     1.0000000
observed  0.7427768
estimate  0.7770543</code></pre>
</div>
</div>
</section>
</section>
<section id="temperature-stratified-models" class="level1">
<h1>Temperature-Stratified Models</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create models for each temperature category</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>temp_categories <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Cold"</span>, <span class="st">"Moderate"</span>, <span class="st">"Warm"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>stratified_models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(temp_cat <span class="cf">in</span> temp_categories) {</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Fitting model for"</span>, temp_cat, <span class="st">"temperatures...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  temp_data <span class="ot">&lt;-</span> analysis_data_full <span class="sc">%&gt;%</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(temp_category <span class="sc">==</span> temp_cat, <span class="sc">!</span><span class="fu">is.na</span>(log_abundance_lag_30min))</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(temp_data) <span class="sc">&lt;</span> <span class="dv">100</span>) {</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Insufficient data for"</span>, temp_cat, <span class="st">"temperatures:"</span>, <span class="fu">nrow</span>(temp_data), <span class="st">"observations</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>  stratified_models[[temp_cat]] <span class="ot">&lt;-</span> <span class="fu">gam</span>(</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    total_butterflies <span class="sc">~</span> </span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(log_abundance_lag_30min, <span class="at">k =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(log_abundance_lag_24hr, <span class="at">k =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(mean_wind, <span class="at">k =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(wind_sd, <span class="at">k =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(sunlight_prop, <span class="at">k =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(minutes_since_first, <span class="at">k =</span> <span class="dv">8</span>, <span class="at">bs =</span> <span class="st">"cc"</span>) <span class="sc">+</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(view_id, <span class="at">bs =</span> <span class="st">"re"</span>),</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">nb</span>(),</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> temp_data,</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"REML"</span>,</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">select =</span> <span class="cn">TRUE</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Model fitted for"</span>, temp_cat, <span class="st">"with"</span>, <span class="fu">nrow</span>(temp_data), <span class="st">"observations</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(stratified_models[[temp_cat]]))</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Fitting model for Cold temperatures...
Model fitted for Cold with 1624 observations

Family: Negative Binomial(31.18) 
Link function: log 

Formula:
total_butterflies ~ s(log_abundance_lag_30min, k = 8) + s(log_abundance_lag_24hr, 
    k = 6) + s(mean_wind, k = 8) + s(wind_sd, k = 6) + s(sunlight_prop, 
    k = 6) + s(minutes_since_first, k = 8, bs = "cc") + s(view_id, 
    bs = "re")

Parametric coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  3.47988    0.01462   237.9   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
                                edf Ref.df    Chi.sq p-value    
s(log_abundance_lag_30min) 5.490354      7 17098.396  &lt;2e-16 ***
s(log_abundance_lag_24hr)  1.556287      5     4.463  0.0835 .  
s(mean_wind)               1.683809      7     5.030  0.0560 .  
s(wind_sd)                 0.095871      5     0.102  0.2968    
s(sunlight_prop)           0.758022      5     3.172  0.0416 *  
s(minutes_since_first)     0.004407      6     0.003  0.4849    
s(view_id)                 1.489514      5     2.319  0.1563    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.971   Deviance explained = 96.4%
-REML = 5415.8  Scale est. = 1         n = 1509

Fitting model for Moderate temperatures...
Model fitted for Moderate with 1328 observations

Family: Negative Binomial(6.786) 
Link function: log 

Formula:
total_butterflies ~ s(log_abundance_lag_30min, k = 8) + s(log_abundance_lag_24hr, 
    k = 6) + s(mean_wind, k = 8) + s(wind_sd, k = 6) + s(sunlight_prop, 
    k = 6) + s(minutes_since_first, k = 8, bs = "cc") + s(view_id, 
    bs = "re")

Parametric coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  3.01239    0.05585   53.94   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
                                 edf Ref.df    Chi.sq  p-value    
s(log_abundance_lag_30min) 5.7000590      7 10638.388  &lt; 2e-16 ***
s(log_abundance_lag_24hr)  0.0029059      5     0.003 0.333140    
s(mean_wind)               1.4374885      7    28.484 0.004887 ** 
s(wind_sd)                 0.0009051      5     0.000 0.850323    
s(sunlight_prop)           2.0694350      5    17.217 0.000331 ***
s(minutes_since_first)     0.0002761      6     0.000 0.820296    
s(view_id)                 4.2596212      5    37.503  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.823   Deviance explained = 84.8%
-REML =   4331  Scale est. = 1         n = 1174

Fitting model for Warm temperatures...
Insufficient data for Warm temperatures: 35 observations</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract wind effects from stratified models</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>stratified_effects <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">names</span>(stratified_models), <span class="cf">function</span>(temp_cat) {</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> stratified_models[[temp_cat]]</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  s_table <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)<span class="sc">$</span>s.table</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  wind_row <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rownames</span>(s_table) <span class="sc">==</span> <span class="st">"s(mean_wind)"</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(wind_row) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">temp_category =</span> temp_cat,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">wind_edf =</span> s_table[wind_row, <span class="st">"edf"</span>],</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">wind_p_value =</span> s_table[wind_row, <span class="st">"p-value"</span>],</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">model_r_sq =</span> <span class="fu">summary</span>(model)<span class="sc">$</span>r.sq,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_obs =</span> <span class="fu">nrow</span>(model<span class="sc">$</span>model)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">temp_category =</span> temp_cat,</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">wind_edf =</span> <span class="cn">NA</span>,</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">wind_p_value =</span> <span class="cn">NA</span>,</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">model_r_sq =</span> <span class="cn">NA</span>,</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_obs =</span> <span class="dv">0</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(stratified_effects, </span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Wind Effects by Temperature Category"</span>, </span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Wind Effects by Temperature Category</caption>
<thead>
<tr class="header">
<th style="text-align: left;">temp_category</th>
<th style="text-align: right;">wind_edf</th>
<th style="text-align: right;">wind_p_value</th>
<th style="text-align: right;">model_r_sq</th>
<th style="text-align: right;">n_obs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Cold</td>
<td style="text-align: right;">1.6838</td>
<td style="text-align: right;">0.0560</td>
<td style="text-align: right;">0.9711</td>
<td style="text-align: right;">1509</td>
</tr>
<tr class="even">
<td style="text-align: left;">Moderate</td>
<td style="text-align: right;">1.4375</td>
<td style="text-align: right;">0.0049</td>
<td style="text-align: right;">0.8230</td>
<td style="text-align: right;">1174</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="diagnostics-for-stratified-models" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics-for-stratified-models">Diagnostics for Stratified Models</h2>
<p>Well check the diagnostics for the Moderate temperature model as an example. This category typically has the most data and represents the core of the dataset. The same checks should be applied to the other stratified models (Cold, Warm) to ensure their validity as well.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="st">"Moderate"</span> <span class="sc">%in%</span> <span class="fu">names</span>(stratified_models)) {</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">appraise</span>(stratified_models[[<span class="st">"Moderate"</span>]]))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Moderate temperature model not available for diagnostics."</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="wind_analysis_enhanced_files/figure-html/diagnostics-stratified-moderate-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Diagnostic plots for the model stratified by moderate temperatures.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="site-specific-analysis-for-consistency" class="level1">
<h1>Site-Specific Analysis for Consistency</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze wind effects for each deployment separately</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>deployments_with_data <span class="ot">&lt;-</span> analysis_data_full <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(deployment_id) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_obs =</span> <span class="fu">n</span>(),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_range =</span> <span class="fu">paste</span>(<span class="fu">min</span>(date), <span class="st">"to"</span>, <span class="fu">max</span>(date)),</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">wind_range =</span> <span class="fu">paste</span>(<span class="fu">round</span>(<span class="fu">min</span>(mean_wind, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>), <span class="st">"to"</span>, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">round</span>(<span class="fu">max</span>(mean_wind, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>), <span class="st">"m/s"</span>),</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_obs <span class="sc">&gt;=</span> <span class="dv">50</span>)  <span class="co"># Minimum observations for reliable analysis</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Deployments with sufficient data:"</span>, <span class="fu">nrow</span>(deployments_with_data)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Deployments with sufficient data: 8"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(deployments_with_data, <span class="at">caption =</span> <span class="st">"Deployments Available for Site-Specific Analysis"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Deployments Available for Site-Specific Analysis</caption>
<thead>
<tr class="header">
<th style="text-align: left;">deployment_id</th>
<th style="text-align: right;">n_obs</th>
<th style="text-align: left;">date_range</th>
<th style="text-align: left;">wind_range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SC1</td>
<td style="text-align: right;">317</td>
<td style="text-align: left;">2023-11-17 to 2023-11-20</td>
<td style="text-align: left;">0 to 2.7 m/s</td>
</tr>
<tr class="even">
<td style="text-align: left;">SC12</td>
<td style="text-align: right;">575</td>
<td style="text-align: left;">2024-01-27 to 2024-02-04</td>
<td style="text-align: left;">0 to 5.3 m/s</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SC2</td>
<td style="text-align: right;">213</td>
<td style="text-align: left;">2023-11-18 to 2023-11-19</td>
<td style="text-align: left;">0 to 1.8 m/s</td>
</tr>
<tr class="even">
<td style="text-align: left;">SC4</td>
<td style="text-align: right;">557</td>
<td style="text-align: left;">2023-12-03 to 2024-01-05</td>
<td style="text-align: left;">0 to 2.8 m/s</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SC6</td>
<td style="text-align: right;">503</td>
<td style="text-align: left;">2023-12-16 to 2024-01-05</td>
<td style="text-align: left;">0 to 3 m/s</td>
</tr>
<tr class="even">
<td style="text-align: left;">SC8</td>
<td style="text-align: right;">541</td>
<td style="text-align: left;">2024-01-05 to 2024-01-27</td>
<td style="text-align: left;">0 to 4.2 m/s</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SC9</td>
<td style="text-align: right;">93</td>
<td style="text-align: left;">2024-01-26 to 2024-01-27</td>
<td style="text-align: left;">0 to 1.2 m/s</td>
</tr>
<tr class="even">
<td style="text-align: left;">SLC6_2</td>
<td style="text-align: right;">163</td>
<td style="text-align: left;">2023-12-22 to 2023-12-24</td>
<td style="text-align: left;">0 to 1.2 m/s</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit site-specific models</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>site_models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>site_effects <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(deploy_id <span class="cf">in</span> deployments_with_data<span class="sc">$</span>deployment_id) {</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Analyzing deployment:"</span>, deploy_id, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  site_data <span class="ot">&lt;-</span> analysis_data_full <span class="sc">%&gt;%</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(deployment_id <span class="sc">==</span> deploy_id, <span class="sc">!</span><span class="fu">is.na</span>(log_abundance_lag_30min))</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(site_data) <span class="sc">&lt;</span> <span class="dv">50</span>) <span class="cf">next</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simple wind effect model for this site</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  site_model <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gam</span>(</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>      total_butterflies <span class="sc">~</span> </span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">s</span>(log_abundance_lag_30min, <span class="at">k =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">s</span>(mean_wind, <span class="at">k =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">s</span>(temperature, <span class="at">k =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">s</span>(minutes_since_first, <span class="at">k =</span> <span class="dv">6</span>, <span class="at">bs =</span> <span class="st">"cc"</span>),</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">nb</span>(),</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> site_data,</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"REML"</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Error fitting model for"</span>, deploy_id, <span class="st">":"</span>, e<span class="sc">$</span>message, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(site_model)) {</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>    site_models[[deploy_id]] <span class="ot">&lt;-</span> site_model</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract wind effect</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>    s_table <span class="ot">&lt;-</span> <span class="fu">summary</span>(site_model)<span class="sc">$</span>s.table</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>    wind_row <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rownames</span>(s_table) <span class="sc">==</span> <span class="st">"s(mean_wind)"</span>)</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(wind_row) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>      site_effects[[deploy_id]] <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">deployment_id =</span> deploy_id,</span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">wind_edf =</span> s_table[wind_row, <span class="st">"edf"</span>],</span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">wind_p_value =</span> s_table[wind_row, <span class="st">"p-value"</span>],</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">wind_significant =</span> s_table[wind_row, <span class="st">"p-value"</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>,</span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">model_r_sq =</span> <span class="fu">summary</span>(site_model)<span class="sc">$</span>r.sq,</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">model_dev_expl =</span> <span class="fu">summary</span>(site_model)<span class="sc">$</span>dev.expl <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_obs =</span> <span class="fu">nrow</span>(site_data)</span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Analyzing deployment: SC1 

Analyzing deployment: SC12 

Analyzing deployment: SC2 

Analyzing deployment: SC4 

Analyzing deployment: SC6 

Analyzing deployment: SC8 

Analyzing deployment: SC9 

Analyzing deployment: SLC6_2 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine site-specific results</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(site_effects) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  site_results_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(site_effects)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add deployment info</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  site_results_summary <span class="ot">&lt;-</span> site_results_df <span class="sc">%&gt;%</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(deployments_with_data, <span class="at">by =</span> <span class="st">"deployment_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(wind_p_value)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(site_results_summary, </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Site-Specific Wind Effects"</span>, </span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits =</span> <span class="dv">4</span>)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summary statistics</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Site-Specific Analysis Summary:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Sites with significant wind effects:"</span>, <span class="fu">sum</span>(site_results_df<span class="sc">$</span>wind_significant), </span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"of"</span>, <span class="fu">nrow</span>(site_results_df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Mean wind p-value across sites:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(site_results_df<span class="sc">$</span>wind_p_value), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Range of R-squared values:"</span>, <span class="fu">round</span>(<span class="fu">min</span>(site_results_df<span class="sc">$</span>model_r_sq), <span class="dv">3</span>), </span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">"to"</span>, <span class="fu">round</span>(<span class="fu">max</span>(site_results_df<span class="sc">$</span>model_r_sq), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"No successful site-specific models fitted</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>  site_results_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Site-Specific Analysis Summary:
Sites with significant wind effects: 4 of 8 
Mean wind p-value across sites: 0.1938 
Range of R-squared values: 0.696 to 0.988 </code></pre>
</div>
</div>
</section>
<section id="data-driven-threshold-testing" class="level1">
<h1>Data-Driven Threshold Testing</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test detected thresholds plus traditional ones</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>all_thresholds <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.0</span>, <span class="fl">2.5</span>, <span class="fl">3.0</span>, detected_thresholds)))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>all_thresholds <span class="ot">&lt;-</span> all_thresholds[all_thresholds <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> all_thresholds <span class="sc">&lt;</span> <span class="dv">6</span>]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Testing thresholds:"</span>, <span class="fu">paste</span>(<span class="fu">round</span>(all_thresholds, <span class="dv">2</span>), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"m/s</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Testing thresholds: 1.5, 2, 2.5, 3 m/s</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>threshold_results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(all_thresholds, <span class="cf">function</span>(threshold) {</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create threshold variable</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  analysis_data_threshold <span class="ot">&lt;-</span> analysis_data_full <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">wind_above_threshold =</span> <span class="fu">as.numeric</span>(mean_wind <span class="sc">&gt;</span> threshold))</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit threshold model</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  threshold_model <span class="ot">&lt;-</span> <span class="fu">gam</span>(</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    total_butterflies <span class="sc">~</span> </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(log_abundance_lag_30min, <span class="at">k =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(log_abundance_lag_24hr, <span class="at">k =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>      wind_above_threshold <span class="sc">+</span>  <span class="co"># Binary threshold effect</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(temperature, <span class="at">k =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(sunlight_prop, <span class="at">k =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(minutes_since_first, <span class="at">k =</span> <span class="dv">8</span>, <span class="at">bs =</span> <span class="st">"cc"</span>) <span class="sc">+</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">s</span>(view_id, <span class="at">bs =</span> <span class="st">"re"</span>),</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">nb</span>(),</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> analysis_data_threshold,</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"REML"</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract threshold effect</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  p_table <span class="ot">&lt;-</span> <span class="fu">summary</span>(threshold_model)<span class="sc">$</span>p.table</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  threshold_row <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rownames</span>(p_table) <span class="sc">==</span> <span class="st">"wind_above_threshold"</span>)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(threshold_row) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">ncol</span>(p_table) <span class="sc">&gt;=</span> <span class="dv">4</span>) {</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">threshold =</span> threshold,</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">coefficient =</span> p_table[threshold_row, <span class="dv">1</span>],  <span class="co"># Estimate column</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">std_error =</span> p_table[threshold_row, <span class="dv">2</span>],    <span class="co"># Std. Error column</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value =</span> p_table[threshold_row, <span class="dv">4</span>],      <span class="co"># p-value column</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">effect_percent =</span> (<span class="fu">exp</span>(p_table[threshold_row, <span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">AIC =</span> <span class="fu">AIC</span>(threshold_model),</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">dev_explained =</span> <span class="fu">summary</span>(threshold_model)<span class="sc">$</span>dev.expl <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">threshold =</span> threshold,</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">coefficient =</span> <span class="cn">NA</span>, <span class="at">std_error =</span> <span class="cn">NA</span>, <span class="at">p_value =</span> <span class="cn">NA</span>,</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">effect_percent =</span> <span class="cn">NA</span>, <span class="at">AIC =</span> <span class="cn">NA</span>, <span class="at">dev_explained =</span> <span class="cn">NA</span></span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(AIC)</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(threshold_results, </span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Threshold Model Comparison"</span>, </span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Threshold Model Comparison</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 15%">
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 19%">
<col style="width: 11%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">threshold</th>
<th style="text-align: right;">coefficient</th>
<th style="text-align: right;">std_error</th>
<th style="text-align: right;">p_value</th>
<th style="text-align: right;">effect_percent</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">dev_explained</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">-0.0988</td>
<td style="text-align: right;">0.0513</td>
<td style="text-align: right;">0.0542</td>
<td style="text-align: right;">-9.4118</td>
<td style="text-align: right;">19933.56</td>
<td style="text-align: right;">92.5890</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">-0.0343</td>
<td style="text-align: right;">0.0368</td>
<td style="text-align: right;">0.3514</td>
<td style="text-align: right;">-3.3685</td>
<td style="text-align: right;">19936.40</td>
<td style="text-align: right;">92.5795</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">0.0160</td>
<td style="text-align: right;">0.0258</td>
<td style="text-align: right;">0.5354</td>
<td style="text-align: right;">1.6144</td>
<td style="text-align: right;">19936.86</td>
<td style="text-align: right;">92.5780</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">0.0054</td>
<td style="text-align: right;">0.0190</td>
<td style="text-align: right;">0.7778</td>
<td style="text-align: right;">0.5389</td>
<td style="text-align: right;">19937.19</td>
<td style="text-align: right;">92.5771</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Best threshold based on AIC</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>best_threshold <span class="ot">&lt;-</span> threshold_results<span class="sc">$</span>threshold[<span class="fu">which.min</span>(threshold_results<span class="sc">$</span>AIC)]</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Best threshold based on AIC:"</span>, best_threshold, <span class="st">"m/s</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Best threshold based on AIC: 3 m/s</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare with Leong's 2 m/s threshold</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>leong_result <span class="ot">&lt;-</span> threshold_results <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">abs</span>(threshold <span class="sc">-</span> <span class="fl">2.0</span>) <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>best_result <span class="ot">&lt;-</span> threshold_results <span class="sc">%&gt;%</span> <span class="fu">filter</span>(threshold <span class="sc">==</span> best_threshold)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(leong_result) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(best_result) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  delta_aic <span class="ot">&lt;-</span> leong_result<span class="sc">$</span>AIC <span class="sc">-</span> best_result<span class="sc">$</span>AIC</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Leong's 2 m/s threshold AIC compared to best:"</span>, <span class="fu">round</span>(delta_aic, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(delta_aic <span class="sc">&gt;</span> <span class="dv">2</span>) {</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Strong evidence against 2 m/s threshold (AIC &gt; 2)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(delta_aic <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Moderate evidence against 2 m/s threshold</span><span class="sc">\n</span><span class="st">"</span>) </span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Little evidence against 2 m/s threshold</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Leong's 2 m/s threshold AIC compared to best: 3.31 
Strong evidence against 2 m/s threshold (AIC &gt; 2)</code></pre>
</div>
</div>
</section>
<section id="biological-relevance-assessment" class="level1">
<h1>Biological Relevance Assessment</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate natural variation in abundance for context</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>natural_variation <span class="ot">&lt;-</span> analysis_data_full <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(deployment_id, date) <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">daily_mean_abundance =</span> <span class="fu">mean</span>(total_butterflies, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">daily_cv =</span> <span class="fu">sd</span>(total_butterflies, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">mean</span>(total_butterflies, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(daily_cv), <span class="fu">is.finite</span>(daily_cv))</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>overall_cv <span class="ot">&lt;-</span> <span class="fu">sd</span>(natural_variation<span class="sc">$</span>daily_mean_abundance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> </span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mean</span>(natural_variation<span class="sc">$</span>daily_mean_abundance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Natural variation in daily mean abundance (CV):"</span>, <span class="fu">round</span>(overall_cv <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Natural variation in daily mean abundance (CV): 127.4 %</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate wind effect sizes in biological context</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>effect_sizes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">comparison =</span> <span class="fu">c</span>(<span class="st">"1 to 2 m/s"</span>, <span class="st">"2 to 3 m/s"</span>, <span class="st">"0 to 3 m/s"</span>, <span class="st">"Best threshold"</span>),</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">wind_change =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="cn">NA</span>),</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, best_threshold)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the best model to predict abundance changes</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>median_conditions <span class="ot">&lt;-</span> analysis_data_full <span class="sc">%&gt;%</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_abundance_lag_30min =</span> <span class="fu">median</span>(log_abundance_lag_30min, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_abundance_lag_24hr =</span> <span class="fu">median</span>(log_abundance_lag_24hr, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">wind_sd =</span> <span class="fu">median</span>(wind_sd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_sustained_wind =</span> <span class="fu">median</span>(max_sustained_wind, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">wind_ramp_rate =</span> <span class="fu">median</span>(wind_ramp_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">temperature =</span> <span class="fu">median</span>(temperature, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sunlight_prop =</span> <span class="fu">median</span>(sunlight_prop, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">minutes_since_first =</span> <span class="fu">median</span>(minutes_since_first, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">view_id =</span> <span class="fu">levels</span>(analysis_data_full<span class="sc">$</span>view_id)[<span class="dv">1</span>]</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict at different wind speeds</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>wind_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>, <span class="fl">2.5</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(wind_levels, <span class="cf">function</span>(wind_speed) {</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  pred_data <span class="ot">&lt;-</span> median_conditions <span class="sc">%&gt;%</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mean_wind =</span> wind_speed)</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(gam_enhanced_full, pred_data, <span class="at">se.fit =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">wind_speed =</span> wind_speed,</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">predicted =</span> pred<span class="sc">$</span>fit[<span class="dv">1</span>],</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> pred<span class="sc">$</span>se.fit[<span class="dv">1</span>],</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower_ci =</span> pred<span class="sc">$</span>fit[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred<span class="sc">$</span>se.fit[<span class="dv">1</span>],</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper_ci =</span> pred<span class="sc">$</span>fit[<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred<span class="sc">$</span>se.fit[<span class="dv">1</span>]</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate effect sizes</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>effect_1to2 <span class="ot">&lt;-</span> (predictions<span class="sc">$</span>predicted[predictions<span class="sc">$</span>wind_speed <span class="sc">==</span> <span class="dv">2</span>] <span class="sc">-</span> </span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>                predictions<span class="sc">$</span>predicted[predictions<span class="sc">$</span>wind_speed <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">/</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>                predictions<span class="sc">$</span>predicted[predictions<span class="sc">$</span>wind_speed <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>effect_2to3 <span class="ot">&lt;-</span> (predictions<span class="sc">$</span>predicted[predictions<span class="sc">$</span>wind_speed <span class="sc">==</span> <span class="dv">3</span>] <span class="sc">-</span> </span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>                predictions<span class="sc">$</span>predicted[predictions<span class="sc">$</span>wind_speed <span class="sc">==</span> <span class="dv">2</span>]) <span class="sc">/</span></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>                predictions<span class="sc">$</span>predicted[predictions<span class="sc">$</span>wind_speed <span class="sc">==</span> <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>effect_0to3 <span class="ot">&lt;-</span> (predictions<span class="sc">$</span>predicted[predictions<span class="sc">$</span>wind_speed <span class="sc">==</span> <span class="dv">3</span>] <span class="sc">-</span> </span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>                predictions<span class="sc">$</span>predicted[predictions<span class="sc">$</span>wind_speed <span class="sc">==</span> <span class="fl">0.5</span>]) <span class="sc">/</span></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>                predictions<span class="sc">$</span>predicted[predictions<span class="sc">$</span>wind_speed <span class="sc">==</span> <span class="fl">0.5</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Threshold effect</span></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(best_threshold) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(best_result) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>  threshold_effect <span class="ot">&lt;-</span> best_result<span class="sc">$</span>effect_percent</span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>  threshold_effect <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Biological Effect Sizes:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Biological Effect Sizes:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1 to 2 m/s wind change:"</span>, <span class="fu">round</span>(effect_1to2, <span class="dv">1</span>), <span class="st">"% change in abundance</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1 to 2 m/s wind change: 0.9 % change in abundance</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2 to 3 m/s wind change:"</span>, <span class="fu">round</span>(effect_2to3, <span class="dv">1</span>), <span class="st">"% change in abundance</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2 to 3 m/s wind change: -2.5 % change in abundance</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"0.5 to 3 m/s wind change:"</span>, <span class="fu">round</span>(effect_0to3, <span class="dv">1</span>), <span class="st">"% change in abundance</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>0.5 to 3 m/s wind change: -0.1 % change in abundance</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(threshold_effect)) {</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Best threshold ("</span>, best_threshold, <span class="st">" m/s) effect:"</span>, <span class="fu">round</span>(threshold_effect, <span class="dv">1</span>), <span class="st">"% change</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Best threshold ( 3  m/s) effect: -9.4 % change</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Natural daily variation (CV):"</span>, <span class="fu">round</span>(overall_cv <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Natural daily variation (CV): 127.4 %</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assessment of biological significance</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Biological Significance Assessment:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Biological Significance Assessment:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>significance_threshold <span class="ot">&lt;-</span> <span class="dv">15</span>  <span class="co"># 15% change considered biologically meaningful</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">abs</span>(effect_1to2) <span class="sc">&gt;</span> significance_threshold) {</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"- 1-2 m/s effect is BIOLOGICALLY SIGNIFICANT (&gt;15%)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"- 1-2 m/s effect is NOT biologically significant (&lt;15%)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>- 1-2 m/s effect is NOT biologically significant (&lt;15%)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">abs</span>(effect_0to3) <span class="sc">&gt;</span> significance_threshold) {</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"- 0.5-3 m/s effect is BIOLOGICALLY SIGNIFICANT (&gt;15%)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"- 0.5-3 m/s effect is NOT biologically significant (&lt;15%)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>- 0.5-3 m/s effect is NOT biologically significant (&lt;15%)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">abs</span>(effect_1to2) <span class="sc">&gt;</span> overall_cv <span class="sc">*</span> <span class="dv">100</span>) {</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"- Wind effects exceed natural daily variation</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"- Wind effects are within natural daily variation</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>- Wind effects are within natural daily variation</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number needed to observe (NNO) calculation</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>baseline_abundance <span class="ot">&lt;-</span> predictions<span class="sc">$</span>predicted[predictions<span class="sc">$</span>wind_speed <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>effect_size_prop <span class="ot">&lt;-</span> <span class="fu">abs</span>(effect_1to2) <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple power calculation for detecting this effect</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>required_n <span class="ot">&lt;-</span> (<span class="fl">1.96</span> <span class="sc">+</span> <span class="fl">1.28</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>effect_size_prop<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Approximate sample size needed to detect 1-2 m/s effect with 80% power:"</span>, </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(required_n), <span class="st">"observations</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Approximate sample size needed to detect 1-2 m/s effect with 80% power: 270987 observations</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Current sample size:"</span>, <span class="fu">nrow</span>(analysis_data_full), <span class="st">"observations</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Current sample size: 2993 observations</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(analysis_data_full) <span class="sc">&gt;</span> required_n) {</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"SUFFICIENT POWER to detect this effect size</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"INSUFFICIENT POWER - may need"</span>, <span class="fu">round</span>(required_n), <span class="st">"observations</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>INSUFFICIENT POWER - may need 270987 observations</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create biological relevance plot</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>p_bio <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(predictions, <span class="fu">aes</span>(<span class="at">x =</span> wind_speed, <span class="at">y =</span> predicted)) <span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_ci, <span class="at">ymax =</span> upper_ci), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> baseline_abundance <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> significance_threshold<span class="sc">/</span><span class="dv">100</span>), </span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> baseline_abundance <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> significance_threshold<span class="sc">/</span><span class="dv">100</span>), </span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Biological Relevance of Wind Effects"</span>,</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Orange lines: "</span>, significance_threshold, <span class="st">"% biological significance threshold"</span>),</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Mean Wind Speed (m/s)"</span>,</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Butterfly Count (log scale)"</span>,</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Predictions at median conditions with 95% CI"</span>) <span class="sc">+</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_bio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="wind_analysis_enhanced_files/figure-html/biological-relevance-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="publication-ready-summary" class="level1">
<h1>Publication-Ready Summary</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comprehensive results table</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>final_results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Analysis =</span> <span class="fu">c</span>(</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Enhanced GAM (Full Dataset)"</span>,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Temperature Stratified Models"</span>,</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Site-Specific Consistency"</span>,</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Data-Driven Threshold"</span>,</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Leong 2 m/s Threshold"</span>,</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Biological Significance"</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Key_Finding =</span> <span class="fu">c</span>(</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="st">"Wind EDF:"</span>, <span class="fu">round</span>(<span class="fu">summary</span>(gam_enhanced_full)<span class="sc">$</span>s.table[<span class="st">"s(mean_wind)"</span>, <span class="st">"edf"</span>], <span class="dv">2</span>), </span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">", p ="</span>, <span class="fu">format</span>(<span class="fu">summary</span>(gam_enhanced_full)<span class="sc">$</span>s.table[<span class="st">"s(mean_wind)"</span>, <span class="st">"p-value"</span>], <span class="at">scientific =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="fu">sum</span>(stratified_effects<span class="sc">$</span>wind_p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">"of"</span>, </span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">nrow</span>(stratified_effects), <span class="st">"temperature categories show significant wind effects"</span>),</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(site_results_df) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="fu">sum</span>(site_results_df<span class="sc">$</span>wind_significant), <span class="st">"of"</span>, <span class="fu">nrow</span>(site_results_df), </span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sites show significant wind effects"</span>)</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {<span class="st">"Insufficient data for site analysis"</span>},</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="st">"Best threshold:"</span>, best_threshold, <span class="st">"m/s, AIC vs 2 m/s:"</span>, </span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">round</span>(leong_result<span class="sc">$</span>AIC <span class="sc">-</span> best_result<span class="sc">$</span>AIC, <span class="dv">1</span>)),</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(leong_result) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"Effect:"</span>, <span class="fu">round</span>(leong_result<span class="sc">$</span>effect_percent, <span class="dv">1</span>), <span class="st">"%, p ="</span>, </span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">format</span>(leong_result<span class="sc">$</span>p_value, <span class="at">scientific =</span> <span class="cn">TRUE</span>))</span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {<span class="st">"Not tested"</span>},</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="st">"1-2 m/s effect:"</span>, <span class="fu">round</span>(effect_1to2, <span class="dv">1</span>), <span class="st">"%, vs natural variation:"</span>, </span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">round</span>(overall_cv <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>)</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Interpretation =</span> <span class="fu">c</span>(</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(<span class="fu">summary</span>(gam_enhanced_full)<span class="sc">$</span>s.table[<span class="st">"s(mean_wind)"</span>, <span class="st">"p-value"</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>, </span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Significant wind effect"</span>, <span class="st">"No significant wind effect"</span>),</span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Temperature moderates wind effects"</span>,</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(site_results_df) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">sum</span>(site_results_df<span class="sc">$</span>wind_significant) <span class="sc">&gt;</span> <span class="fu">nrow</span>(site_results_df)<span class="sc">/</span><span class="dv">2</span>) {</span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Consistent across sites"</span></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Inconsistent across sites"</span></span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {<span class="st">"Cannot assess"</span>},</span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(<span class="fu">abs</span>(leong_result<span class="sc">$</span>AIC <span class="sc">-</span> best_result<span class="sc">$</span>AIC) <span class="sc">&gt;</span> <span class="dv">2</span>, </span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a>           <span class="st">"2 m/s threshold not supported"</span>, <span class="st">"2 m/s threshold plausible"</span>),</span>
<span id="cb91-42"><a href="#cb91-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(<span class="fu">nrow</span>(leong_result) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> leong_result<span class="sc">$</span>p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>, </span>
<span id="cb91-43"><a href="#cb91-43" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Statistically significant"</span>, <span class="st">"Not statistically significant"</span>),</span>
<span id="cb91-44"><a href="#cb91-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(<span class="fu">abs</span>(effect_1to2) <span class="sc">&gt;</span> significance_threshold, </span>
<span id="cb91-45"><a href="#cb91-45" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Biologically meaningful"</span>, <span class="st">"Not biologically meaningful"</span>)</span>
<span id="cb91-46"><a href="#cb91-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb91-47"><a href="#cb91-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb91-48"><a href="#cb91-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-49"><a href="#cb91-49" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(final_results, </span>
<span id="cb91-50"><a href="#cb91-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Comprehensive Wind Analysis Results Summary"</span>,</span>
<span id="cb91-51"><a href="#cb91-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Analysis Component"</span>, <span class="st">"Key Finding"</span>, <span class="st">"Interpretation"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Comprehensive Wind Analysis Results Summary</caption>
<colgroup>
<col style="width: 24%">
<col style="width: 48%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Analysis Component</th>
<th style="text-align: left;">Key Finding</th>
<th style="text-align: left;">Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Enhanced GAM (Full Dataset)</td>
<td style="text-align: left;">Wind EDF: 2.05 , p = 8.941704e-03</td>
<td style="text-align: left;">Significant wind effect</td>
</tr>
<tr class="even">
<td style="text-align: left;">Temperature Stratified Models</td>
<td style="text-align: left;">1 of 2 temperature categories show significant wind effects</td>
<td style="text-align: left;">Temperature moderates wind effects</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Site-Specific Consistency</td>
<td style="text-align: left;">4 of 8 sites show significant wind effects</td>
<td style="text-align: left;">Inconsistent across sites</td>
</tr>
<tr class="even">
<td style="text-align: left;">Data-Driven Threshold</td>
<td style="text-align: left;">Best threshold: 3 m/s, AIC vs 2 m/s: 3.3</td>
<td style="text-align: left;">2 m/s threshold not supported</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Leong 2 m/s Threshold</td>
<td style="text-align: left;">Effect: 1.6 %, p = 5.354277e-01</td>
<td style="text-align: left;">Not statistically significant</td>
</tr>
<tr class="even">
<td style="text-align: left;">Biological Significance</td>
<td style="text-align: left;">1-2 m/s effect: 0.9 %, vs natural variation: 127.4 %</td>
<td style="text-align: left;">Not biologically meaningful</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall conclusion</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">paste</span>(<span class="fu">rep</span>(<span class="st">"="</span>, <span class="dv">60</span>), <span class="at">collapse =</span> <span class="st">""</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 ============================================================ </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"OVERALL CONCLUSION</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>OVERALL CONCLUSION</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(<span class="fu">rep</span>(<span class="st">"="</span>, <span class="dv">60</span>), <span class="at">collapse =</span> <span class="st">""</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================ </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>wind_significant <span class="ot">&lt;-</span> <span class="fu">summary</span>(gam_enhanced_full)<span class="sc">$</span>s.table[<span class="st">"s(mean_wind)"</span>, <span class="st">"p-value"</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>effect_meaningful <span class="ot">&lt;-</span> <span class="fu">abs</span>(effect_1to2) <span class="sc">&gt;</span> significance_threshold</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>threshold_supported <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">nrow</span>(leong_result) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abs</span>(leong_result<span class="sc">$</span>AIC <span class="sc">-</span> best_result<span class="sc">$</span>AIC) <span class="sc">&lt;=</span> <span class="dv">2</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="cn">FALSE</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(wind_significant <span class="sc">&amp;&amp;</span> effect_meaningful) {</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  conclusion <span class="ot">&lt;-</span> <span class="st">"Wind has STATISTICALLY SIGNIFICANT and BIOLOGICALLY MEANINGFUL effects on monarch abundance"</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(wind_significant <span class="sc">&amp;&amp;</span> <span class="sc">!</span>effect_meaningful) {</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>  conclusion <span class="ot">&lt;-</span> <span class="st">"Wind has STATISTICALLY SIGNIFICANT but SMALL effects on monarch abundance"</span>  </span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>  conclusion <span class="ot">&lt;-</span> <span class="st">"NO STRONG EVIDENCE that wind significantly affects monarch abundance"</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(conclusion, <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Wind has STATISTICALLY SIGNIFICANT but SMALL effects on monarch abundance </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(threshold_supported) {</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Leong's 2 m/s threshold is SUPPORTED by the data</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Leong's 2 m/s threshold is NOT SUPPORTED; effects appear continuous</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Leong's 2 m/s threshold is NOT SUPPORTED; effects appear continuous</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Effect sizes relative to natural variation suggest wind effects are "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Effect sizes relative to natural variation suggest wind effects are </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">abs</span>(effect_1to2) <span class="sc">&gt;</span> overall_cv <span class="sc">*</span> <span class="dv">100</span>) {</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"ABOVE normal daily fluctuations</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"WITHIN normal daily fluctuations</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>WITHIN normal daily fluctuations</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">This analysis provides robust evidence for challenging or supporting conventional</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
This analysis provides robust evidence for challenging or supporting conventional</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"wisdom about wind effects on overwintering monarch butterflies.</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>wisdom about wind effects on overwintering monarch butterflies.</code></pre>
</div>
</div>
<hr>
<p><strong>Enhanced Analysis completed:</strong> 2025-08-12 13:12:51.462631</p>
<p><strong>Contact:</strong> Kyle Nessen</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>